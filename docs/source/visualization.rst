Application
============

Once you can run the model and generate the output, we have two scripts that post-process and analyze the output with visualizations.
The tools are coded in Jupyter Notebook and were developed such that the code blocks must be executed in series. 
Additonal python packages required by the tools are listed at the top and can be found in counda-forge.
Both tools load the output file from the model and make visualizations based on the output variables.

--------------------
Plotting Tool
--------------------

This tool generates the validation plot for the Energy subsystem using EIA data of ethanol produced in Iowa and compares it with the modelled production of Ethanol.
Additionally, the tool also generates an interactive widget, which can plot the time series of variables outputted by the model for a specific county.
The widget includes all 99 counties of Iowa and can plot all the modelled output variables. The function of the code blocks are explained below:
 
 * Code block 1, imports the required packages
 * Code block 2, reads the output file generated by the batch analysis script and defines the required widgets
 * Code block 3, generates the validation plot for Ethanol
  .. image:: figures/E_prod.png
    :width: 700
    :alt: Ethanol Validation Plot
 * Code block 4, saves the plot if desired
 * Code block 5, defines a function to generate the desired plot based on the inputs of the widget
 * Code block 6, generates the interactive widget

--------------------
Choropleth Map Tool
--------------------

This tool generates choropleth maps, which is a type of statistical thematic map that uses pseudocolor to visualize the modelled data geographically.
The plot is made by an interactive widgets with inputs for the desired year and can plot all the output variables.
Additionally, the tool can also save the maps for all variables as a set of images to generate a time series GIF.

 * Code block 1, imports the required packages ::

   import os
   import numpy as np
   import pandas as pd
   from matplotlib import pyplot as plt
   import ipywidgets as widgets

 * Code block 2, reads the output file generated by the batch analysis script and defines the required widgets ::

   # Load Result Data
   loc_R = 'Data_Output/Results.csv'
   df_result = pd.read_csv(loc_R)

   # Parse Result Data
   ns_data = df_result.iloc[:, 0]
   yc_data = df_result.iloc[:, 1]
   ys_data = df_result.iloc[:, 2]     
   ep_data = df_result.iloc[:, 3]

   # Load Animal Agriculture Data
   loc_AA = 'Data_Input/animal_agriculture_data/IFEW_Counties_1997_2019.csv'
   df_AA = pd.read_csv(loc_AA) # Animal Agricultural dataframe

   # Parse Animal Agricultural Data
   yc_real = df_AA["CornGrainYield_bupacre"]
   ys_real = df_AA["SoybeansYield_bupacre"]

   years = pd.Series(range(1997, 2020))

   # Load Energy Validation Data
   loc_NRG = 'Data_Validation/Iowa Historical Ethanol and Biodiesel Production EIA.csv'
   df_AA = pd.read_csv(loc_NRG)

   # Parse Energy Validation Data
   val_nrg_yr = df_AA["Year"]
   val_nrg_bd = df_AA["BDPRP"] * 42 / 1e6 # Thousand of Barrels to MGal
   val_nrg_ep = df_AA["ENPRP"] * 42 / 1e6 # Thousand of Barrels to MGal
   tot_ep = np.zeros(len(years))

   # Define Dropdown Widget
   county_dropdown = widgets.Dropdown(
      options=[('Adair', 1), ('Adams', 2), ('Allamakee', 3), ('Appanoose', 4), ('Audubon', 5), ('Benton', 6), ('Black Hawk', 7), ('Boone', 8), ('Bremer', 9), ('Buchanan', 10), ('Buena Vista', 11), ('Butler', 12), ('Calhoun', 13), ('Carroll', 14), ('Cass', 15), ('Cedar', 16), ('Cerro Gordo', 17), ('Cherokee', 18), ('Chickasaw', 19), ('Clarke', 20), ('Clay', 21), ('Clayton', 22), ('Clinton', 23), ('Crawford', 24), ('Dallas', 25), ('Davis', 26), ('Decatur', 27), ('Delaware', 28), ('Des Moines', 29), ('Dickinson', 30), ('Dubuque', 31), ('Emmet', 32), ('Fayette', 33), ('Floyd', 34), ('Franklin', 35), ('Fremont', 36), ('Greene', 37), ('Grundy', 38), ('Guthrie', 39), ('Hamilton', 40), ('Hancock', 41), ('Hardin', 42), ('Harrison', 43), ('Henry', 44), ('Howard', 45), ('Humboldt', 46), ('Ida', 47), ('Iowa', 48), ('Jackson', 49), ('Jasper', 50), ('Jefferson', 51), ('Johnson', 52), ('Jones', 53), ('Keokuk', 54), ('Kossuth', 55), ('Lee', 56), ('Linn', 57), ('Louisa', 58), ('Lucas', 59), ('Lyon', 60), ('Madison', 61), ('Mahaska', 62), ('Marion', 63), ('Marshall', 64), ('Mills', 65), ('Mitchell', 66), ('Monona', 67), ('Monroe', 68), ('Montgomery', 69), ('Muscatine', 70), ('Obrien', 71), ('Osceola', 72), ('Page', 73), ('Palo Alto', 74), ('Plymouth', 75), ('Pocahontas', 76), ('Polk', 77), ('Pottawattamie', 78), ('Poweshiek', 79), ('Ringgold', 80), ('Sac', 81), ('Scott', 82), ('Shelby', 83), ('Sioux', 84), ('Story', 85), ('Tama', 86), ('Taylor', 87), ('Union', 88), ('Van Buren', 89), ('Wapello', 90), ('Warren', 91), ('Washington', 92), ('Wayne', 93), ('Webster', 94), ('Winnebago', 95), ('Winneshiek', 96), ('Woodbury', 97), ('Worth', 98), ('Wright', 99)],
      description='County:',
      disabled = False)

 * Code block 3, defines a function to generate the desired choropleth map based on the inputs of the widget
 * Code block 4, generates the interactive widget
 * Code block 5, creates directories to save images
 * Code block 6, saves static images of all the maps created by the tool

 From the static images generated by the tool, GIFs were created and are shown below:

 * Nitrogen Surplus:
  .. image:: figures/NS.gif
    :width: 800
    :alt: Nitrogen Surplus GIF
 * Ethanol Production:
  .. image:: figures/EP.gif
    :width: 800
    :alt: Ethanol Production GIF
 * Corn Yield:
  .. image:: figures/CY.gif
    :width: 800
    :alt: Corn Yield GIF
 * Soybean Yield:
  .. image:: figures/SY.gif
    :width: 800
    :alt: Soybean Yield GIF


 

   
   
